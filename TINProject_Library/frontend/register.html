<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title data-i18n="registerTitle">Studiosus - Register</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<nav>
    <a href="/" data-i18n="home">Home</a>
    <div style="float:right;">
        <button id="langEn">EN</button>
        <button id="langPl">PL</button>
    </div>
</nav>

<h1 data-i18n="register">Register</h1>

<section class="card">
    <form id="regForm">
        <input name="username" placeholder="Username" required data-i18n-placeholder="username">
        <input name="password" type="password" placeholder="Password" required data-i18n-placeholder="password">
        <input name="role" placeholder="Role (user/admin)" value="user" data-i18n-placeholder="rolePlaceholder">
        <button type="submit" data-i18n="register">Register</button>
        <div class="msg" id="msg"></div>
    </form>
</section>

<script src="/js/api.js"></script>
<script src="/js/i18n.js"></script>
<script>
    const form = document.getElementById('regForm');
    const msg = document.getElementById('msg');

    function setOk(key) { msg.className = 'msg ok'; msg.textContent = t(key); }
    function setErr(keyOrText, isKey = true) {
        msg.className = 'msg err';
        msg.textContent = isKey ? t(keyOrText) : keyOrText;
    }

    document.getElementById("langEn").addEventListener("click", () => {
        setLang("en");
        applyI18n();
    });
    document.getElementById("langPl").addEventListener("click", () => {
        setLang("pl");
        applyI18n();
    });
    applyI18n();

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = '';
        const data = Object.fromEntries(new FormData(form).entries());

        if ((data.username || '').trim().length < 2) { setErr('usernameTooShort'); return; }
        if ((data.password || '').length < 3) { setErr('passwordTooShort'); return; }

        try {
            await apiSend('/auth/register', 'POST', {
                username: data.username.trim(),
                password: data.password,
                role: (data.role || 'user').trim().toLowerCase()
            });

            setOk('registerSuccessRedirect');
            setTimeout(() => location.href = '/login.html', 700);
        } catch (err) {
            setErr(err.message, false);
        }
    });
</script>
</body>
</html>
